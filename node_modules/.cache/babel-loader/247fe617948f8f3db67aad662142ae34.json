{"ast":null,"code":"var _jsxFileName = \"/industry/app/src/DashboardManage/TemplateForPie.js\";\nimport React, { Component } from 'react';\nimport _ from 'lodash';\nimport $ from 'jquery';\nimport { withRouter } from 'react-router';\nimport { wyAxiosPost } from '../components/WyAxios';\nimport WyDatePicker from '../components/WyDatePicker';\nimport WySpin from '../components/WySpin';\nimport Pie from '../components/Pie'; //import contextList from '../SubPage/ContextList'\n\nclass TemplateForPie extends Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      name: '',\n      title: '',\n      unit: '',\n      pieData: [],\n      isSpining: false,\n      autoHeight: 300,\n      subTime: [],\n      showViewData: {},\n      updateTime: 0,\n      secondData: {} //获取数据\n\n    };\n\n    this.getCurViewData = () => {\n      if (this.state.showViewData.data && Object.keys(this.state.showViewData.data).length > 0) {\n        const info = _.cloneDeep(this.state.showViewData.data);\n\n        info.viewType = this.state.showViewData.viewType;\n        info.pageId = this.props.pageId;\n\n        if (this.state.subTime.length > 0 && this.props.env !== 'set') {\n          info.start_time = this.state.subTime[0];\n          info.last_time = this.state.subTime[1];\n        }\n\n        wyAxiosPost('Dashboard/getModuleData', {\n          info\n        }, result => {\n          const responseData = result.data.msg;\n\n          if (this.state.subTime.length === 0) {\n            const curTime = [];\n            curTime.push(responseData.start_time);\n            curTime.push(responseData.last_time);\n\n            if (this._isMounted) {\n              this.setState({\n                name: responseData.name,\n                title: responseData.title,\n                unit: responseData.unit,\n                pieData: responseData.data,\n                subTime: _.cloneDeep(curTime),\n                secondData: responseData.secondData ? responseData.secondData : {}\n              });\n            }\n          } else {\n            if (this._isMounted) {\n              this.setState({\n                name: responseData.name,\n                title: responseData.title,\n                unit: responseData.unit,\n                pieData: responseData.data,\n                secondData: responseData.secondData ? responseData.secondData : {}\n              });\n            }\n          }\n        });\n      }\n    };\n\n    this.getCurViewDataForFresh = () => {\n      if (this.state.showViewData.data && Object.keys(this.state.showViewData.data).length > 0) {\n        const info = _.cloneDeep(this.state.showViewData.data);\n\n        info.viewType = this.state.showViewData.viewType; //info.api = this.state.showViewData.data.dataMethod\n\n        wyAxiosPost('Dashboard/getModuleData', {\n          info\n        }, result => {\n          const responseData = result.data.msg;\n          const curTime = [];\n          curTime.push(responseData.start_time);\n          curTime.push(responseData.last_time);\n\n          if (this._isMounted) {\n            this.setState({\n              name: responseData.name,\n              title: responseData.title,\n              unit: responseData.unit,\n              pieData: responseData.data,\n              subTime: _.cloneDeep(curTime),\n              secondData: responseData.secondData ? responseData.secondData : {}\n            });\n          }\n        });\n      }\n    };\n\n    this.subTimeChange = (value, event) => {\n      if (this._isMounted) {\n        this.setState({\n          subTime: value\n        }, () => {\n          this.getCurViewData();\n        });\n      }\n    };\n\n    this.updateData = () => {\n      if (this.pieTimer1) {\n        clearInterval(this.pieTimer1);\n      }\n\n      const run = () => {\n        if (this.state.updateTime !== 0) {\n          if (this.pieTimer2) {\n            clearInterval(this.pieTimer2);\n          }\n\n          let time = this.state.updateTime;\n          this.pieTimer2 = setInterval(() => {\n            this.getCurViewDataForFresh();\n          }, time * 1000);\n\n          if (this.pieTimer1) {\n            clearInterval(this.pieTimer1);\n          }\n        } else {\n          if (this.pieTimer2) {\n            clearInterval(this.pieTimer2);\n          }\n        }\n      };\n\n      this.pieTimer1 = setInterval(run, 5000);\n    };\n  }\n\n  componentDidMount() {\n    this._isMounted = true;\n\n    if (this._isMounted) {\n      this.setState({\n        showViewData: this.props.showViewData,\n        autoHeight: this.props.autoHeight,\n        updateTime: this.props.updateTime\n      }, () => {\n        this.getCurViewData();\n\n        if (this.state.updateTime && this.props.env !== 'set') {\n          this.updateData();\n        }\n      });\n    }\n  }\n\n  componentWillReceiveProps(nextProps) {\n    if (!_.isEqual(this.props.showViewData, nextProps.showViewData) || this.props.autoHeight !== nextProps.autoHeight || this.props.updateTime && nextProps.upDateTime && this.props.updateTime !== nextProps.upDateTime) {\n      if (this._isMounted) {\n        this.setState({\n          showViewData: nextProps.showViewData,\n          autoHeight: nextProps.autoHeight\n        }, () => {\n          this.getCurViewData();\n\n          if (this.state.updateTime && this.props.env !== 'set') {\n            this.updateData();\n          }\n        });\n      }\n    }\n  }\n\n  componentWillUnmount() {\n    this._isMounted = false;\n\n    if (this.pieTimer1) {\n      clearInterval(this.pieTimer1);\n    }\n\n    if (this.pieTimer2) {\n      clearInterval(this.pieTimer2);\n    }\n  } // chartContextmenu = (params,dom,position,viewId)=>{\n  //   $('.drcontainer').removeClass('dropShow').addClass('dropHide')\n  //   $(dom).closest('.gridContainer').find('.drcontainer').removeClass('dropHide').addClass('dropShow')\n  //   if(this.state.secondData){\n  //     const {listType,objType} = this.state.secondData\n  //     let info ={\n  //       listType,\n  //       start_time: this.state.subTime[0],\n  //       last_time: this.state.subTime[1],\n  //       obj: params.name,\n  //       objType,\n  //       previousPath:this.props.location.pathname\n  //     }\n  //     this.props.setDropListInfo({\n  //        dropData: contextList(info),\n  //        dropPosition: {x:position.x+\"px\",y:position.y+\"px\"},\n  //        isexist: true\n  //     })\n  //   }\n  // }\n\n\n  render() {\n    return React.createElement(\"div\", {\n      className: \"amodule\",\n      style: {\n        margin: \"0px\"\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 191\n      },\n      __self: this\n    }, this.props.env === 'set' ? '' : React.createElement(\"div\", {\n      className: \"moduleHeader\",\n      style: {\n        display: \"flex\"\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 196\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"moduleHeaderIn\",\n      style: {\n        flex: \"1 1 auto\"\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 197\n      },\n      __self: this\n    }, this.state.showViewData.data && Object.keys(this.state.showViewData.data).length > 0 ? this.state.showViewData.data.moduleName : ''), React.createElement(\"div\", {\n      style: {\n        float: \"right\",\n        flex: \"0 0 300px\"\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 200\n      },\n      __self: this\n    }, React.createElement(WyDatePicker, {\n      curTime: this.state.subTime,\n      rangeTimeChange: this.subTimeChange,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 201\n      },\n      __self: this\n    }))), React.createElement(\"div\", {\n      className: \"moduleBody\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 205\n      },\n      __self: this\n    }, React.createElement(WySpin, {\n      isSpining: this.state.isSpining,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 206\n      },\n      __self: this\n    }, React.createElement(Pie, {\n      name: this.state.name ? this.state.name : '',\n      title: this.state.title ? this.state.title : '',\n      unit: this.state.unit ? this.state.unit : '',\n      pieData: this.state.pieData ? this.state.pieData : [],\n      height: this.state.autoHeight //onContextmenu={this.chartContextmenu}\n      ,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 207\n      },\n      __self: this\n    }))));\n  }\n\n}\n\nexport default withRouter(TemplateForPie);","map":{"version":3,"sources":["/industry/app/src/DashboardManage/TemplateForPie.js"],"names":["React","Component","_","$","withRouter","wyAxiosPost","WyDatePicker","WySpin","Pie","TemplateForPie","state","name","title","unit","pieData","isSpining","autoHeight","subTime","showViewData","updateTime","secondData","getCurViewData","data","Object","keys","length","info","cloneDeep","viewType","pageId","props","env","start_time","last_time","result","responseData","msg","curTime","push","_isMounted","setState","getCurViewDataForFresh","subTimeChange","value","event","updateData","pieTimer1","clearInterval","run","pieTimer2","time","setInterval","componentDidMount","componentWillReceiveProps","nextProps","isEqual","upDateTime","componentWillUnmount","render","margin","display","flex","moduleName","float"],"mappings":"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","sourcesContent":["import React, { Component } from 'react'\r\nimport _ from 'lodash'\r\nimport $ from 'jquery'\r\nimport { withRouter } from 'react-router'\r\n\r\nimport { wyAxiosPost } from '../components/WyAxios'\r\nimport WyDatePicker from '../components/WyDatePicker'\r\nimport WySpin from '../components/WySpin'\r\nimport Pie from '../components/Pie'\r\n//import contextList from '../SubPage/ContextList'\r\n\r\n\r\nclass TemplateForPie extends Component{\r\n  state={\r\n    name:'',\r\n    title:'',\r\n    unit:'',\r\n    pieData:[],\r\n\r\n    isSpining: false,\r\n    autoHeight: 300,\r\n    subTime: [],\r\n    showViewData:{},\r\n    updateTime: 0,\r\n    secondData: {}\r\n  }\r\n\r\n  //获取数据\r\n  getCurViewData = ()=>{\r\n    if(this.state.showViewData.data && Object.keys(this.state.showViewData.data).length>0){\r\n      const info = _.cloneDeep(this.state.showViewData.data)\r\n      info.viewType = this.state.showViewData.viewType\r\n      info.pageId = this.props.pageId\r\n      if(this.state.subTime.length>0 && this.props.env !== 'set'){\r\n        info.start_time = this.state.subTime[0]\r\n        info.last_time = this.state.subTime[1]\r\n      }\r\n      wyAxiosPost('Dashboard/getModuleData',{info},(result)=>{\r\n        const responseData = result.data.msg\r\n        if(this.state.subTime.length === 0){\r\n          const curTime = []\r\n          curTime.push(responseData.start_time)\r\n          curTime.push(responseData.last_time)\r\n          if(this._isMounted){\r\n            this.setState({\r\n              name: responseData.name,\r\n              title: responseData.title,\r\n              unit: responseData.unit,\r\n              pieData: responseData.data,\r\n              subTime: _.cloneDeep(curTime),\r\n              secondData: responseData.secondData?responseData.secondData:{}\r\n            })\r\n          }\r\n        }else{\r\n          if(this._isMounted){\r\n            this.setState({\r\n              name: responseData.name,\r\n              title: responseData.title,\r\n              unit: responseData.unit,\r\n              pieData: responseData.data,\r\n              secondData: responseData.secondData?responseData.secondData:{}\r\n            })\r\n          }\r\n        }\r\n      })\r\n    }\r\n  }\r\n  getCurViewDataForFresh = ()=>{\r\n    if(this.state.showViewData.data && Object.keys(this.state.showViewData.data).length>0){\r\n      const info = _.cloneDeep(this.state.showViewData.data)\r\n      info.viewType = this.state.showViewData.viewType\r\n      //info.api = this.state.showViewData.data.dataMethod\r\n      wyAxiosPost('Dashboard/getModuleData',{info},(result)=>{\r\n        const responseData = result.data.msg\r\n        const curTime = []\r\n        curTime.push(responseData.start_time)\r\n        curTime.push(responseData.last_time)\r\n        if(this._isMounted){\r\n          this.setState({\r\n            name: responseData.name,\r\n            title: responseData.title,\r\n            unit: responseData.unit,\r\n            pieData: responseData.data,\r\n            subTime: _.cloneDeep(curTime),\r\n            secondData: responseData.secondData?responseData.secondData:{}\r\n          })\r\n        }\r\n      })\r\n    }\r\n  }\r\n\r\n  subTimeChange = (value,event)=>{\r\n    if(this._isMounted){\r\n      this.setState({\r\n        subTime: value\r\n      },()=>{\r\n        this.getCurViewData()\r\n      })\r\n    }\r\n  }\r\n  //数据更新\r\n  updateData = ()=>{\r\n    if(this.pieTimer1){\r\n      clearInterval(this.pieTimer1)\r\n    }\r\n    const run = ()=>{\r\n      if(this.state.updateTime !== 0){\r\n        if(this.pieTimer2){\r\n          clearInterval(this.pieTimer2)\r\n        }\r\n        let time = this.state.updateTime\r\n        this.pieTimer2 = setInterval(()=>{\r\n          this.getCurViewDataForFresh()\r\n        },time*1000)\r\n        if(this.pieTimer1){\r\n          clearInterval(this.pieTimer1)\r\n        }\r\n      }else{\r\n        if(this.pieTimer2){\r\n          clearInterval(this.pieTimer2)\r\n        }\r\n      }\r\n    }\r\n    this.pieTimer1 = setInterval(run,5000)\r\n  }\r\n  componentDidMount(){\r\n    this._isMounted = true\r\n    if(this._isMounted){\r\n      this.setState({\r\n        showViewData: this.props.showViewData,\r\n        autoHeight: this.props.autoHeight,\r\n        updateTime: this.props.updateTime\r\n      },()=>{\r\n        this.getCurViewData()\r\n        if(this.state.updateTime && this.props.env !== 'set'){\r\n          this.updateData()\r\n        }\r\n      })\r\n    }\r\n  }\r\n  componentWillReceiveProps(nextProps){\r\n    if(\r\n      ! (_.isEqual(this.props.showViewData,nextProps.showViewData)) ||\r\n      this.props.autoHeight !== nextProps.autoHeight ||\r\n      (this.props.updateTime && nextProps.upDateTime && this.props.updateTime !== nextProps.upDateTime)\r\n    ){\r\n      if(this._isMounted){\r\n        this.setState({\r\n          showViewData: nextProps.showViewData,\r\n          autoHeight: nextProps.autoHeight\r\n        },()=>{\r\n          this.getCurViewData()\r\n          if(this.state.updateTime && this.props.env !== 'set'){\r\n            this.updateData()\r\n          }\r\n        })\r\n      }\r\n    }\r\n  }\r\n  componentWillUnmount(){\r\n    this._isMounted = false\r\n    if(this.pieTimer1){\r\n      clearInterval(this.pieTimer1)\r\n    }\r\n    if(this.pieTimer2){\r\n      clearInterval(this.pieTimer2)\r\n    }\r\n  }\r\n  // chartContextmenu = (params,dom,position,viewId)=>{\r\n  //   $('.drcontainer').removeClass('dropShow').addClass('dropHide')\r\n  //   $(dom).closest('.gridContainer').find('.drcontainer').removeClass('dropHide').addClass('dropShow')\r\n  //   if(this.state.secondData){\r\n  //     const {listType,objType} = this.state.secondData\r\n  //     let info ={\r\n  //       listType,\r\n  //       start_time: this.state.subTime[0],\r\n  //       last_time: this.state.subTime[1],\r\n  //       obj: params.name,\r\n  //       objType,\r\n  //       previousPath:this.props.location.pathname\r\n  //     }\r\n  //     this.props.setDropListInfo({\r\n  //        dropData: contextList(info),\r\n  //        dropPosition: {x:position.x+\"px\",y:position.y+\"px\"},\r\n  //        isexist: true\r\n  //     })\r\n  //   }\r\n  // }\r\n  render(){\r\n    return(\r\n      <div className=\"amodule\" style={{margin:\"0px\"}}>\r\n      {\r\n        this.props.env === 'set'?\r\n        ''\r\n        :\r\n        <div className=\"moduleHeader\" style={{display:\"flex\"}}>\r\n          <div className=\"moduleHeaderIn\"style={{flex:\"1 1 auto\"}}>\r\n            {this.state.showViewData.data && Object.keys(this.state.showViewData.data).length>0?this.state.showViewData.data.moduleName:''}\r\n          </div>\r\n            <div style={{float: \"right\",flex:\"0 0 300px\"}}>\r\n              <WyDatePicker curTime={this.state.subTime} rangeTimeChange={this.subTimeChange}/>\r\n            </div>\r\n        </div>\r\n      }\r\n        <div className=\"moduleBody\">\r\n          <WySpin isSpining={this.state.isSpining}>\r\n            <Pie\r\n              name={this.state.name?this.state.name:''}\r\n              title={this.state.title?this.state.title:''}\r\n              unit={this.state.unit?this.state.unit:''}\r\n              pieData={this.state.pieData?this.state.pieData:[]}\r\n              height={this.state.autoHeight}\r\n              //onContextmenu={this.chartContextmenu}\r\n            />\r\n          </WySpin>\r\n        </div>\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\nexport default withRouter(TemplateForPie)\r\n"]},"metadata":{},"sourceType":"module"}