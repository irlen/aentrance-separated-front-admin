{"ast":null,"code":"import \"antd/es/modal/style\";\nimport _Modal from \"antd/es/modal\";\nvar _jsxFileName = \"/industry/app/src/DashboardManage/TemplateForCalc.js\";\nimport React, { Component } from 'react';\nimport _ from 'lodash';\nimport { withRouter } from 'react-router';\nimport $ from 'jquery';\nimport { wyAxiosPost } from '../components/WyAxios'; //import contextList from '../SubPage/ContextList'\n\nimport WyDatePicker from '../components/WyDatePicker';\n\nclass TemplateForCalc extends Component {\n  constructor(...args) {\n    super(...args);\n    this.state = {\n      showViewData: {},\n      autoHeight: 100,\n      updateTime: 0,\n      secondData: {},\n      title: '',\n      value: '',\n      visible: false,\n      subTime: []\n    };\n\n    this.getCurViewData = () => {\n      if (this.state.showViewData.data && Object.keys(this.state.showViewData.data).length > 0) {\n        const info = {};\n        info.viewType = this.state.showViewData.viewType;\n        info.api = this.state.showViewData.data.dataMethod;\n\n        if (this.state.subTime.length > 0 && this.props.env !== 'set') {\n          info.start_time = this.state.subTime[0];\n          info.last_time = this.state.subTime[1];\n        }\n\n        wyAxiosPost('Screen/getScreenData', {\n          info\n        }, result => {\n          const responseData = result.data.msg;\n          const title = responseData.title,\n                value = responseData.value;\n\n          if (this.state.subTime.length === 0) {\n            const subTime = [];\n            subTime.push(responseData.start_time);\n            subTime.push(responseData.last_time);\n            this.setState({\n              title,\n              value,\n              subTime\n            });\n          } else {\n            this.setState({\n              title,\n              value\n            });\n          }\n        });\n      }\n    };\n\n    this.getCurViewDataForFresh = () => {\n      if (this.state.showViewData.data && Object.keys(this.state.showViewData.data).length > 0) {\n        const info = {};\n        info.viewType = this.state.showViewData.viewType;\n        info.api = this.state.showViewData.data.dataMethod;\n        wyAxiosPost('Screen/getScreenData', {\n          info\n        }, result => {\n          const responseData = result.data.msg;\n          const title = responseData.title,\n                value = responseData.value;\n          const subTime = [];\n          subTime.push(responseData.start_time);\n          subTime.push(responseData.last_time);\n          this.setState({\n            title,\n            value,\n            subTime\n          });\n        });\n      }\n    };\n\n    this.updateData = () => {\n      if (this.calcTimer1) {\n        clearInterval(this.calcTimer1);\n      }\n\n      const run = () => {\n        if (this.state.updateTime !== 0) {\n          if (this.calcTimer2) {\n            clearInterval(this.calcTimer2);\n          }\n\n          let time = this.state.updateTime;\n          this.calcTimer2 = setInterval(() => {\n            this.getCurViewDataForFresh();\n          }, time * 1000);\n\n          if (this.calcTimer1) {\n            clearInterval(this.calcTimer1);\n          }\n        } else {\n          if (this.calcTimer2) {\n            clearInterval(this.calcTimer2);\n          }\n        }\n      };\n\n      this.calcTimer1 = setInterval(run, 5000);\n    };\n\n    this.showModal = () => {\n      this.setState({\n        visible: true\n      });\n    };\n\n    this.handleOk = e => {\n      this.setState({\n        visible: false\n      });\n    };\n\n    this.handleCancel = e => {\n      this.setState({\n        visible: false\n      });\n    };\n\n    this.subTimeChange = (value, event) => {\n      this.setState({\n        subTime: value\n      }, () => {\n        this.getCurViewData();\n      });\n    };\n  }\n\n  componentDidMount() {\n    this.setState({\n      showViewData: this.props.showViewData,\n      autoHeight: this.props.autoHeight,\n      updateTime: this.props.updateTime\n    }, () => {\n      this.getCurViewData();\n\n      if (this.state.updateTime && this.props.env !== 'set') {\n        this.updateData();\n      }\n    });\n  }\n\n  componentWillReceiveProps(nextProps) {\n    if (!_.isEqual(this.props.showViewData, nextProps.showViewData) || this.props.autoHeight !== nextProps.autoHeight || this.props.updateTime && nextProps.upDateTime && this.props.updateTime !== nextProps.upDateTime) {\n      this.setState({\n        showViewData: nextProps.showViewData,\n        autoHeight: nextProps.autoHeight,\n        updateTime: nextProps.updateTime\n      }, () => {\n        this.getCurViewData();\n\n        if (this.state.updateTime && this.props.env !== 'set') {\n          this.updateData();\n        }\n      });\n    }\n  }\n\n  componentWillUnmount() {\n    if (this.calcTimer1) {\n      clearInterval(this.calcTimer1);\n    }\n\n    if (this.calcTimer2) {\n      clearInterval(this.calcTimer2);\n    }\n  } //获取数据\n\n\n  render() {\n    const height = this.state.autoHeight + 20;\n    return React.createElement(\"div\", {\n      className: \"amodule\",\n      style: {\n        margin: \"0px\"\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 187\n      },\n      __self: this\n    }, this.props.env === 'set' ? '' : React.createElement(\"div\", {\n      className: \"moduleHeader\",\n      style: {\n        display: \"flex\"\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 192\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      className: \"moduleHeaderIn\",\n      style: {\n        flex: \"1 1 auto\"\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 193\n      },\n      __self: this\n    }, this.state.showViewData.data && Object.keys(this.state.showViewData.data).length > 0 ? this.state.showViewData.data.moduleName : ''), React.createElement(\"div\", {\n      style: {\n        flex: \"0 0 20px\"\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 196\n      },\n      __self: this\n    }, React.createElement(\"span\", {\n      onClick: this.showModal,\n      style: {\n        cursor: \"pointer\"\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 197\n      },\n      __self: this\n    }, React.createElement(\"i\", {\n      className: \"fa fa-list-alt\",\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 197\n      },\n      __self: this\n    })))), React.createElement(\"div\", {\n      className: \"moduleBody\" //onContextMenu={this.contextMenu} \n      ,\n      style: {\n        height,\n        textAlign: \"center\",\n        cursor: \"pointer\",\n        fontSize: \"40px\",\n        lineHeight: height - 20 + \"px\",\n        color: \"rgba(0,255,102,0.8)\"\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 201\n      },\n      __self: this\n    }, this.state.value), React.createElement(_Modal, {\n      title: \"\\u5C5E\\u6027\",\n      visible: this.state.visible,\n      onOk: this.handleOk,\n      onCancel: this.handleCancel,\n      footer: null,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 206\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      style: {\n        display: \"flex\"\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 213\n      },\n      __self: this\n    }, React.createElement(\"div\", {\n      style: {\n        flex: \"0 0 100px\"\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 214\n      },\n      __self: this\n    }, \"\\u7EDF\\u8BA1\\u65F6\\u95F4\\u8303\\u56F4\\uFF1A\"), React.createElement(\"div\", {\n      style: {\n        flex: \"1 1 auto\"\n      },\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 215\n      },\n      __self: this\n    }, React.createElement(WyDatePicker, {\n      curTime: this.state.subTime,\n      rangeTimeChange: this.subTimeChange,\n      __source: {\n        fileName: _jsxFileName,\n        lineNumber: 215\n      },\n      __self: this\n    })))));\n  }\n\n}\n\nexport default withRouter(TemplateForCalc);","map":{"version":3,"sources":["/industry/app/src/DashboardManage/TemplateForCalc.js"],"names":["React","Component","_","withRouter","$","wyAxiosPost","WyDatePicker","TemplateForCalc","state","showViewData","autoHeight","updateTime","secondData","title","value","visible","subTime","getCurViewData","data","Object","keys","length","info","viewType","api","dataMethod","props","env","start_time","last_time","result","responseData","msg","push","setState","getCurViewDataForFresh","updateData","calcTimer1","clearInterval","run","calcTimer2","time","setInterval","showModal","handleOk","e","handleCancel","subTimeChange","event","componentDidMount","componentWillReceiveProps","nextProps","isEqual","upDateTime","componentWillUnmount","render","height","margin","display","flex","moduleName","cursor","textAlign","fontSize","lineHeight","color"],"mappings":"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","sourcesContent":["import React, { Component } from 'react'\r\nimport _ from 'lodash'\r\nimport { withRouter } from 'react-router'\r\nimport $ from 'jquery'\r\nimport { Modal } from 'antd'\r\n\r\nimport { wyAxiosPost } from '../components/WyAxios'\r\n//import contextList from '../SubPage/ContextList'\r\nimport WyDatePicker from '../components/WyDatePicker'\r\n\r\nclass TemplateForCalc extends Component{\r\n  state = {\r\n    showViewData: {},\r\n    autoHeight: 100,\r\n    updateTime: 0,\r\n    secondData: {},\r\n    title:'',\r\n    value:'',\r\n    visible: false,\r\n    subTime:[]\r\n  }\r\n  componentDidMount(){\r\n    this.setState({\r\n      showViewData: this.props.showViewData,\r\n      autoHeight: this.props.autoHeight,\r\n      updateTime: this.props.updateTime\r\n    },()=>{\r\n      this.getCurViewData()\r\n      if(this.state.updateTime && this.props.env !== 'set'){\r\n        this.updateData()\r\n      }\r\n    })\r\n  }\r\n  componentWillReceiveProps(nextProps){\r\n    if(\r\n      ! (_.isEqual(this.props.showViewData,nextProps.showViewData)) ||\r\n      this.props.autoHeight !== nextProps.autoHeight ||\r\n      (this.props.updateTime && nextProps.upDateTime && (this.props.updateTime !== nextProps.upDateTime))\r\n    ){\r\n      this.setState({\r\n        showViewData: nextProps.showViewData,\r\n        autoHeight: nextProps.autoHeight,\r\n        updateTime: nextProps.updateTime\r\n      },()=>{\r\n        this.getCurViewData()\r\n        if(this.state.updateTime && this.props.env !== 'set'){\r\n          this.updateData()\r\n        }\r\n      })\r\n    }\r\n  }\r\n  componentWillUnmount(){\r\n    if(this.calcTimer1){\r\n      clearInterval(this.calcTimer1)\r\n    }\r\n    if(this.calcTimer2){\r\n      clearInterval(this.calcTimer2)\r\n    }\r\n  }\r\n  //获取数据\r\n  getCurViewData = ()=>{\r\n    if(this.state.showViewData.data && Object.keys(this.state.showViewData.data).length>0){\r\n      const info = {}\r\n      info.viewType = this.state.showViewData.viewType\r\n      info.api = this.state.showViewData.data.dataMethod\r\n      if(this.state.subTime.length>0 && this.props.env !== 'set'){\r\n        info.start_time = this.state.subTime[0]\r\n        info.last_time = this.state.subTime[1]\r\n      }\r\n      wyAxiosPost('Screen/getScreenData',{info},(result)=>{\r\n        const responseData = result.data.msg\r\n        const { title,value } = responseData\r\n        if(this.state.subTime.length === 0){\r\n          const subTime = []\r\n          subTime.push(responseData.start_time)\r\n          subTime.push(responseData.last_time)\r\n          this.setState({\r\n            title,\r\n            value,\r\n            subTime\r\n          })\r\n        }else{\r\n          this.setState({\r\n            title,\r\n            value\r\n          })\r\n        }\r\n      })\r\n    }\r\n  }\r\n  getCurViewDataForFresh = ()=>{\r\n    if(this.state.showViewData.data && Object.keys(this.state.showViewData.data).length>0){\r\n      const info = {}\r\n      info.viewType = this.state.showViewData.viewType\r\n      info.api = this.state.showViewData.data.dataMethod\r\n      wyAxiosPost('Screen/getScreenData',{info},(result)=>{\r\n        const responseData = result.data.msg\r\n        const { title,value } = responseData\r\n        const subTime = []\r\n        subTime.push(responseData.start_time)\r\n        subTime.push(responseData.last_time)\r\n        this.setState({\r\n          title,\r\n          value,\r\n          subTime\r\n        })\r\n      })\r\n    }\r\n  }\r\n  //数据更新\r\n  updateData = ()=>{\r\n    if(this.calcTimer1){\r\n      clearInterval(this.calcTimer1)\r\n    }\r\n    const run = ()=>{\r\n      if(this.state.updateTime !== 0){\r\n        if(this.calcTimer2){\r\n          clearInterval(this.calcTimer2)\r\n        }\r\n        let time = this.state.updateTime\r\n        this.calcTimer2 = setInterval(()=>{\r\n          this.getCurViewDataForFresh()\r\n        },time*1000)\r\n        if(this.calcTimer1){\r\n          clearInterval(this.calcTimer1)\r\n        }\r\n      }else{\r\n        if(this.calcTimer2){\r\n          clearInterval(this.calcTimer2)\r\n        }\r\n      }\r\n    }\r\n    this.calcTimer1 = setInterval(run,5000)\r\n  }\r\n  // contextMenu = (event)=>{\r\n  //   const e= event||this.event\r\n  //   $('.drcontainer').removeClass('dropShow').addClass('dropHide')\r\n  //   $(e.target).closest('.gridContainer').find('.drcontainer').removeClass('dropHide').addClass('dropShow')\r\n  //   if(this.state.secondData){\r\n  //     let info ={\r\n  //       start_time: this.state.subTime[0],\r\n  //       last_time: this.state.subTime[1],\r\n  //       listType:'danger',\r\n  //       obj: this.state.showViewData.data.dataMethod,\r\n  //       objType:'danger',\r\n  //       previousPath:this.props.location.pathname\r\n  //     }\r\n  //     const x = e.clientX\r\n  //     const y = e.clientY\r\n  //     if(this.props.setDropListInfo){\r\n  //       this.props.setDropListInfo({\r\n  //          dropData: contextList(info),\r\n  //          dropPosition: {x:x+\"px\",y:y+\"px\"},\r\n  //          isexist: true\r\n  //       })\r\n  //     }\r\n  //   }\r\n  // }\r\n\r\n  showModal = () => {\r\n   this.setState({\r\n     visible: true,\r\n   });\r\n }\r\n\r\n  handleOk = (e) => {\r\n   this.setState({\r\n     visible: false,\r\n   });\r\n }\r\n\r\n  handleCancel = (e) => {\r\n   this.setState({\r\n     visible: false,\r\n   });\r\n }\r\n  subTimeChange = (value,event)=>{\r\n   this.setState({\r\n     subTime: value\r\n   },()=>{\r\n     this.getCurViewData()\r\n   })\r\n }\r\n  render(){\r\n    const height = this.state.autoHeight + 20\r\n    return(\r\n      <div className=\"amodule\" style={{margin:\"0px\"}}>\r\n      {\r\n        this.props.env === 'set'?\r\n        ''\r\n        :\r\n        <div className=\"moduleHeader\" style={{display:\"flex\"}}>\r\n          <div className=\"moduleHeaderIn\"style={{flex:\"1 1 auto\"}}>\r\n            {this.state.showViewData.data && Object.keys(this.state.showViewData.data).length>0?this.state.showViewData.data.moduleName:''}\r\n          </div>\r\n          <div style={{flex:\"0 0 20px\"}}>\r\n            <span onClick={this.showModal} style={{cursor: \"pointer\"}}><i className=\"fa fa-list-alt\"></i></span>\r\n          </div>\r\n        </div>\r\n      }\r\n        <div className=\"moduleBody\"\r\n        //onContextMenu={this.contextMenu} \r\n        style={{height,textAlign:\"center\", cursor:\"pointer\",fontSize:\"40px\",lineHeight:height-20+\"px\",color:\"rgba(0,255,102,0.8)\"}}>\r\n          {this.state.value}\r\n        </div>\r\n        <Modal\r\n          title=\"属性\"\r\n          visible={this.state.visible}\r\n          onOk={this.handleOk}\r\n          onCancel={this.handleCancel}\r\n          footer={null}\r\n        >\r\n          <div style={{display: \"flex\"}}>\r\n            <div style={{flex:\"0 0 100px\"}}>统计时间范围：</div>\r\n            <div style={{flex:\"1 1 auto\"}}><WyDatePicker curTime={this.state.subTime} rangeTimeChange={this.subTimeChange}/></div>\r\n          </div>\r\n        </Modal>\r\n      </div>\r\n    )\r\n  }\r\n}\r\n\r\nexport default withRouter(TemplateForCalc)\r\n"]},"metadata":{},"sourceType":"module"}